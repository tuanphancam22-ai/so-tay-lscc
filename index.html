<script>
    const SHEET_ID = 1REXuH0gV0GvQG96elQ0NWODek31vLaQCNO8gnBtSdKE;
    const SHEET_NAME = 'Sheet1';
    // Đường dẫn để lấy dữ liệu CSV từ Google Sheets
    const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;

    let data = [];

    // Hàm lấy dữ liệu từ Google Sheets
    async function fetchData() {
        const response = await fetch(URL);
        const text = await response.text();
        
        // Chuyển đổi CSV thành mảng JSON (Bỏ qua hàng đầu tiên)
        const rows = text.split('\n').slice(1);
        data = rows.map(row => {
            const cols = row.split('","').map(c => c.replace(/"/g, ''));
            return { cat: cols[0], title: cols[1], detail: cols[2], alert: cols[3] };
        });
        
        render(data);
    }

    function render(list) {
        document.getElementById('content').innerHTML = list.map(item => `
            <div class="card">
                <div class="category">${item.cat}</div>
                <div class="title">${item.title}</div>
                <div class="detail">${item.detail}</div>
                <div class="red-flag">⚠️ ${item.alert}</div>
            </div>
        `).join('');
    }

    // Chức năng tìm kiếm
    document.getElementById('searchInput').addEventListener('input', (e) => {
        const filtered = data.filter(i => 
            i.title.toLowerCase().includes(e.target.value.toLowerCase()) ||
            i.cat.toLowerCase().includes(e.target.value.toLowerCase())
        );
        render(filtered);
    });

    // Chạy hàm lấy dữ liệu khi trang web load
    fetchData();
</script>
